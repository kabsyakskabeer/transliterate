<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile-Friendly Custom Keyboard</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --key-color: #2d2d2d;
            --key-active-color: #3a3a3a;
            --text-color: #e0e0e0;
            --special-key-color: #333333;
            --border-color: #444;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 10px;
            -webkit-user-select: none;
            user-select: none;
            background-color: var(--bg-color);
            color: var(--text-color);
            touch-action: manipulation;
            min-height: 100vh;
            box-sizing: border-box;
            padding-bottom: 60vh; /* Space for keyboard */
        }
        
        h1 {
            font-size: 1.5rem;
            text-align: center;
            margin: 10px 0;
        }
        
        #textInput {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            margin: 10px 0 20px;
            box-sizing: border-box;
            background-color: #252525;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            caret-color: transparent;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            resize: none;
        }
        
        #textInput.keyboard-visible {
            caret-color: var(--text-color);
        }
        
        #keyboardContainer {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--bg-color);
            padding: 8px 4px;
            box-shadow: 0 -4px 15px var(--shadow-color);
            z-index: 1000;
            border-top: 1px solid var(--border-color);
            touch-action: manipulation;
        }
        
        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 6px;
            width: 100%;
            touch-action: manipulation;
        }
        
        .key {
            height: 48px;
            min-width: 8%;
            margin: 0 2px;
            padding: 0 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--key-color);
            color: var(--text-color);
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
            box-shadow: 0 2px 0 var(--shadow-color);
            transition: transform 0.1s, background-color 0.1s;
            flex: 1;
        }
        
        .key:active, .key.active {
            background-color: var(--key-active-color);
            transform: translateY(2px);
            box-shadow: none;
        }
        
        .key-special {
            background-color: var(--special-key-color);
            font-size: 14px;
            flex: 1.5;
        }
        
        .key-space {
            flex: 8;
            min-width: 40%;
        }
        
        .key-shift, .key-enter, .key-backspace, .key-tab, .key-caps {
            flex: 1.5;
            min-width: 12%;
        }
        
        .key-backspace::before {
            content: "⌫";
        }
        
        .key-tab::before {
            content: "⇥";
        }
        
        .key-caps::before {
            content: "⇪";
        }
        
        .key-shift::before {
            content: "⇧";
        }
        
        .key-enter::before {
            content: "↵";
        }

        /* Mobile-specific adjustments */
        @media (max-width: 600px) {
            .key {
                height: 42px;
                font-size: 14px;
            }
            #textInput {
                font-size: 15px;
                padding: 12px;
            }
        }

        @media (max-width: 400px) {
            .key {
                height: 38px;
                font-size: 13px;
                margin: 0 1px;
            }
        }
    </style>
</head>
<body>
    <h1>Custom Mobile Keyboard</h1>
    <textarea id="textInput" placeholder="Tap here to type..." readonly></textarea>
    <div id="keyboardContainer"></div>

    <!-- Sound effects (host these files yourself in production) -->
    <audio id="keySound" src="https://www.soundjay.com/buttons/sounds/button-09.mp3" preload="auto"></audio>
    <audio id="keySoundSpecial" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const textInput = document.getElementById('textInput');
            const keyboardContainer = document.getElementById('keyboardContainer');
            const keySound = document.getElementById('keySound');
            const keySoundSpecial = document.getElementById('keySoundSpecial');
            
            let isShift = false;
            let isCaps = false;
            let activeKey = null;

            // Keyboard layout (Q replaced with K)
            const layout = {
                default: [
                    ['`','1','2','3','4','5','6','7','8','9','0','-','=',{class: 'key-special key-backspace', display: '', value: 'Backspace'}],
                    [{class: 'key-special key-tab', display: '', value: 'Tab'},'k','w','e','r','t','y','u','i','o','p','[',']','\\'],
                    [{class: 'key-special key-caps', display: '', value: 'Caps'},'a','s','d','f','g','h','j','k','l',';',"'",{class: 'key-special key-enter', display: '', value: 'Enter'}],
                    [{class: 'key-special key-shift', display: '', value: 'Shift'},'z','x','c','v','b','n','m',',','.','/',{class: 'key-special key-shift', display: '', value: 'Shift'}],
                    [{class: 'key-special key-space', display: 'Space', value: ' '}]
                ],
                shift: [
                    ['~','!','@','#','$','%','^','&','*','(',')','_','+',{class: 'key-special key-backspace', display: '', value: 'Backspace'}],
                    [{class: 'key-special key-tab', display: '', value: 'Tab'},'K','W','E','R','T','Y','U','I','O','P','{','}','|'],
                    [{class: 'key-special key-caps', display: '', value: 'Caps'},'A','S','D','F','G','H','J','K','L',':','"',{class: 'key-special key-enter', display: '', value: 'Enter'}],
                    [{class: 'key-special key-shift', display: '', value: 'Shift'},'Z','X','C','V','B','N','M','<','>','?',{class: 'key-special key-shift', display: '', value: 'Shift'}],
                    [{class: 'key-special key-space', display: 'Space', value: ' '}]
                ]
            };

            // Create keyboard
            function createKeyboard(layoutName = 'default') {
                keyboardContainer.innerHTML = '';
                
                layout[layoutName].forEach(row => {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'keyboard-row';
                    
                    row.forEach(key => {
                        const keyElement = document.createElement('div');
                        
                        if (typeof key === 'object') {
                            keyElement.className = `key ${key.class}`;
                            keyElement.textContent = key.display;
                            keyElement.dataset.value = key.value;
                        } else {
                            keyElement.className = 'key';
                            keyElement.textContent = key;
                            keyElement.dataset.value = key;
                        }
                        
                        // Touch/mouse event handlers
                        keyElement.addEventListener('pointerdown', (e) => {
                            e.preventDefault();
                            handleKeyDown(keyElement);
                        });
                        
                        keyElement.addEventListener('pointerup', () => handleKeyUp(keyElement));
                        keyElement.addEventListener('pointerleave', () => {
                            if (activeKey === keyElement) handleKeyUp(keyElement);
                        });
                        
                        rowDiv.appendChild(keyElement);
                    });
                    
                    keyboardContainer.appendChild(rowDiv);
                });
            }

            // Handle key down
            function handleKeyDown(keyElement) {
                if (activeKey) return;
                
                activeKey = keyElement;
                keyElement.classList.add('active');
                
                // Play sound
                if (keyElement.classList.contains('key-special')) {
                    keySoundSpecial.currentTime = 0;
                    keySoundSpecial.play();
                } else {
                    keySound.currentTime = 0;
                    keySound.play();
                }
                
                const keyValue = keyElement.dataset.value;
                handleKeyPress(keyValue);
            }

            // Handle key up
            function handleKeyUp(keyElement) {
                if (activeKey !== keyElement) return;
                keyElement.classList.remove('active');
                activeKey = null;
            }

            // Handle key presses
            function handleKeyPress(key) {
                const startPos = textInput.selectionStart;
                const endPos = textInput.selectionEnd;
                const currentValue = textInput.value;
                
                switch(key) {
                    case 'Backspace':
                        if (startPos === endPos && startPos > 0) {
                            textInput.value = currentValue.substring(0, startPos - 1) + currentValue.substring(endPos);
                            setCursorPosition(startPos - 1);
                        } else {
                            textInput.value = currentValue.substring(0, startPos) + currentValue.substring(endPos);
                            setCursorPosition(startPos);
                        }
                        break;
                    case 'Tab':
                        insertAtCursor('\t');
                        break;
                    case 'Caps':
                        isCaps = !isCaps;
                        createKeyboard(isShift || isCaps ? 'shift' : 'default');
                        break;
                    case 'Enter':
                        insertAtCursor('\n');
                        break;
                    case 'Shift':
                        isShift = !isShift;
                        createKeyboard(isShift || isCaps ? 'shift' : 'default');
                        break;
                    case ' ':
                        insertAtCursor(' ');
                        break;
                    default:
                        insertAtCursor(key);
                        if (isShift && !isCaps) {
                            isShift = false;
                            createKeyboard('default');
                        }
                }
                
                textInput.focus();
            }

            // Insert text at cursor position
            function insertAtCursor(text) {
                const startPos = textInput.selectionStart;
                const endPos = textInput.selectionEnd;
                textInput.value = textInput.value.substring(0, startPos) + text + textInput.value.substring(endPos);
                setCursorPosition(startPos + text.length);
            }

            // Set cursor position
            function setCursorPosition(pos) {
                textInput.selectionStart = pos;
                textInput.selectionEnd = pos;
            }

            // Initialize keyboard
            createKeyboard();

            // Show keyboard when textarea is focused
            textInput.addEventListener('focus', function() {
                keyboardContainer.style.display = 'block';
                textInput.classList.add('keyboard-visible');
                // Scroll to show input field (for mobile)
                setTimeout(() => {
                    textInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            });

            // Hide keyboard when clicking outside
            document.addEventListener('pointerdown', function(e) {
                if (e.target !== textInput && !keyboardContainer.contains(e.target)) {
                    keyboardContainer.style.display = 'none';
                    textInput.classList.remove('keyboard-visible');
                }
            });

            // Prevent default keyboard completely
            textInput.addEventListener('pointerdown', function(e) {
                e.preventDefault();
                this.focus();
            });
            
            // Additional prevention for iOS
            document.addEventListener('touchmove', function(e) {
                if (e.target === textInput || keyboardContainer.contains(e.target)) {
                    e.preventDefault();
                }
            }, { passive: false });
        });
    </script>
</body>
</html>
